<%@ template version="1.0" language="groovy" contentType="text/html; charset=UTF-8" %>
<%@ template import="solidstack.hyperdb.*" %>
<%
def schema = request.parameters.schema

include( template: "/template", title: "Views", body: {
	List< View > views = Database.getViews( schema );
%>
		<table id="views">
			<tr><th>Views</th><th># records</th></tr>
<%		for( View view : views ) { %>
			<tr><td><a href="views/${view.name}">${view.name}</a></td><td></td></tr>
<%		} %>
		</table>
		<script>
			var views = document.getElementById( "views" );
			var rows = views.rows;
			for( var i = 1, len = rows.length; i < len; i++ )
			{
				var cells = rows[ i ].cells;
				var view = cells[ 0 ].innerText;
				getAsync( "/schemas/${schema}/tables/" + view + "/recordcount",
					function( cell )
					{
						return function( result )
						{
							cell.innerHTML = result;
						}
					} ( cells[ 1 ] )
				)
			}
		</script>
<% } ) %>
